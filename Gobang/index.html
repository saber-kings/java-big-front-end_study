<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/calendar.css" rel="stylesheet" />
		<link href="https://at.alicdn.com/t/font_1822513_9ft9h1qrc0l.css" rel="stylesheet" />
		<script src="js/vue.min.js"></script>
		<script src="js/axios.min.js"></script>
		<script src="js/moment.min.js"></script>
		<script src="js/calendar.js" charset="utf-8"></script>
		<style type="text/css">
			* {
				margin: 0px;
				padding: 0px;
				border: 0px;
			}

			html,
			body {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
				background-image: url(img/main2.png);
				background-size: 100% 100%;
			}

			.calendar-content .chose {
				color: #fff !important;
				background-color: #2AC845;
				border: 0px solid #007AFF;
				border-radius: 25px;
			}

			.my-p {
				color: white;
				font-weight: 700;
			}

			.mask {
				position: absolute;
				width: 100% !important;
				height: 100% !important;
				background-color: rgba(0, 0, 0, .9) !important;
				z-index: 999;
			}

			.mask .lodding {
				width: 10%;
				height: 10%;
				margin: 25% auto;
				margin-bottom: 0;
				border-radius: 3px;
				color: white;
				text-align: center;
				line-height: 100%;
			}

			.mask .modal-box {
				margin: 40px auto;
				margin-bottom: 0;
				padding-top: 20px;
				padding-bottom: 5px;
				max-width: 60%;
				max-height: 80%;
				background-color: white;
				border-radius: 5px;
			}

			.vl {
				width: 60%;
				margin: 0 auto;
				height: 50px;
			}

			.vl-btn {
				padding: 10px 0;
			}

			.main-header {
				margin-top: 0;
				margin-left: 0;
				width: 100%;
				height: 45px;
				position: relative;
				z-index: 10;
			}

			.profile-left-top1 {
				width: 20%;
				height: 40px;
				margin-top: 5px;
				margin-left: 20px;
				float: left;
			}

			.profile-left-top2 {
				width: 10%;
				height: 40px;
				margin-top: 5px;
				margin-left: 5px;
				text-align: center;
				float: left;
			}

			.header-vertical-img {
				width: 30px;
				height: 30px;
				margin-top: 5px;
			}

			.header-horizontal-img {
				width: 20px;
				height: 20px;
				margin-top: 10px;
			}

			.header-horizontal-icon {
				width: 20px;
				height: 20px;
				line-height: 20px;
				text-align: center;
				margin-top: 10px;
				color: #F0AD4E;
			}

			.header-horizontal-text {
				float: left;
				height: 20px;
				padding: 0 5px;
				margin-top: 10px;
				line-height: 20px;
				border-radius: 5px;
				background-color: rgba(0, 0, 0, 0.3);
			}

			.profile-center-top {
				width: 20%;
				height: 40px;
				position: absolute;
				top: 5px;
				left: 44%;
				text-align: center;
			}

			.center-top-logo {
				margin-top: 2px;
				border-radius: 5px;
				width: 28px;
				height: 28px;
				float: left;
			}

			.center-top-text {
				float: left;
				margin-top: 5px;
				margin-left: 2px;
				height: 30px;
				font-size: small;
			}

			.profile-avatar {
				border-radius: 5px;
				width: 40px;
				height: 40px;
				float: left;
			}

			.profile-nickname {
				float: left;
				margin-left: 2px;
				height: 40px;
				font-size: small;
			}

			.profile-right-top1 {
				width: 5%;
				height: 40px;
				margin-top: 5px;
				margin-right: 20px;
				text-align: center;
				float: right;
			}

			.profile-right-top2 {
				width: 12%;
				height: 30px;
				margin-top: 5px;
				margin-right: 5px;
				float: right;
			}

			.profile-right-top3 {
				width: 12%;
				height: 30px;
				margin-top: 5px;
				margin-right: 5px;
				float: right;
			}

			.mui-popup,
			.mui-popup-in {
				background-color: #efeff4;
			}

			.jb-xrlb {
				width: 150px;
				height: 30px;
				margin: 0 auto;
			}


			.jb-xrlb-img {
				width: 20px;
				height: 20px;
				margin: 5px 0;
			}

			.jb-xrlb-text {
				height: 20px;
				padding: 0 5px;
				margin: 5px 0;
				line-height: 20px;
				border-radius: 5px;
			}

			.content-left-three {
				width: 45px;
				height: 55px;
				text-align: center;
				position: relative;
				left: 2px;
			}

			.content-left-three-img {
				width: 100%;
				height: 40px;
			}

			.content-left-three-text-div {
				margin-top: -10px;
				width: 100%;
				height: 10px;
			}

			.content-left-three-text-p {
				font-size: 10px;
				line-height: 10px;
				color: #F0AD4E;
			}

			.content-right-four {
				background-repeat: no-repeat;
				background-size: 100% 100%;
				width: 40%;
				height: 80px;
				float: left;
				text-align: center;
			}

			.content-right-four-text {
				position: relative;
				bottom: -80px;
				color: gold;
			}

			.footer-bar-tab {
				background-color: transparent;
				box-shadow: none;
			}

			.footer-bar-tab-content {
				width: 70%;
				height: 50px;
				padding-top: 10px;
				border-radius: 0px 40px 0px 0px;
				background-color: rgba(0, 0, 0, 0.3);
			}

			.footer-bar-content-div {
				width: 22%;
				height: 30px;
			}

			.footer-bar-content-narrow-img {
				width: 25px;
				height: 30px;
			}

			.footer-bar-content-wide-img {
				width: 30px;
				height: 30px;
			}

			.footer-bar-content-icon {
				width: 25px;
				height: 30px;
				color: #F0AD4E;
				font-size: 25px;
				font-weight: 800;
				line-height: 30px;
				text-align: center;
			}

			.footer-bar-content-text {
				width: 30px;
				height: 30px;
				line-height: 30px;
				color: #F0AD4E;
			}

			[v-cloak] {
				display: none;
			}
		</style>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			//è·å–åŸå§‹çª—å£çš„é«˜åº¦
			var originalHeight = document.documentElement.clientHeight || document.body.clientHeight;

			window.onresize = function() {
				//è½¯é”®ç›˜å¼¹èµ·ä¸éšè—  éƒ½ä¼šå¼•èµ·çª—å£çš„é«˜åº¦å‘ç”Ÿå˜åŒ–
				var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
				if (resizeHeight * 1 < originalHeight * 1) { //resizeHeight<originalHeightè¯æ˜çª—å£è¢«æŒ¤å‹äº†
					plus.webview.currentWebview().setStyle({
						height: originalHeight
					});
				}
			}
		</script>
	</head>
	<body>
		<div id="app">
			<transition leave-active-class="animated fadeOut" enter-active-class="animated fadeIn">
				<div id="mask" class="mui-backdrop mask" v-show="showMask">
					<transition leave-active-class="animated zoomOut" enter-active-class="animated zoomIn">
						<div id="mask-lodding" class="lodding" v-show="isLodding">
							<span class="mui-icon mui-icon-spinner-cycle mui-spin"></span>
						</div>
					</transition>
					<transition leave-active-class="animated zoomOut" enter-active-class="animated zoomIn">
						<div class="modal-box" style="max-width: 300px;overflow: scroll;" v-show="showProfile" v-cloak>
							<ul class="mui-table-view" id="rooms">
								<li class="mui-table-view-cell mui-media">
									<a href="javascript:void(0);">
										<img class="mui-media-object mui-pull-left" :src="user.avatar">
										<div class="mui-media-body">
											æ˜µç§°:&nbsp;{{user.nickName}}
											<p class='mui-ellipsis'>
												èƒœç‡:&nbsp;{{user.totalGames===0?'100%':user.winGames/user.totalGames + '%'}}&#x0009;
												æ€»å±€æ•°:&nbsp;{{user.totalGames}}
											</p>
										</div>
									</a>
								</li>
							</ul>
							<div class="vl vl-btn" style="width: 20%;">
								<button type="button" class="mui-btn mui-btn-primary" @click="closeUserInfo()">å…³é—­</button>
							</div>
						</div>
					</transition>
					<transition leave-active-class="animated zoomOut" enter-active-class="animated zoomIn">
						<div class="modal-box" style="max-width: 300px;overflow: scroll;" v-show="showRooms" v-cloak>
							<ul class="mui-table-view" id="rooms">
								<li class="mui-table-view-cell" href="javascript:void(0);" style="text-align: center;">
									ç‚¹å‡»åŠ å…¥
								</li>
								<li class="mui-table-view-cell mui-media" v-for="r in rooms" @click="joinRoom(r.id, r.status)">
									<a href="javascript:void(0);">
										<img class="mui-media-object mui-pull-left" :src="r.avatar">
										<div class="mui-media-body">
											{{r.roomName}}
											<p class='mui-ellipsis'>
												æˆ¿ä¸»:&nbsp;{{r.homeowner}}&#x0009;
												çŠ¶æ€:&nbsp;{{r.status===1?"å·²æ»¡":"æœªæ»¡"}}
											</p>
										</div>
									</a>
								</li>
							</ul>
							<div class="vl vl-btn" style="width: 20%;">
								<button type="button" class="mui-btn mui-btn-primary" @click="closeRoomList()">å–æ¶ˆ</button>
							</div>
						</div>
					</transition>
					<transition leave-active-class="animated zoomOut" enter-active-class="animated zoomIn">
						<div class="modal-box" style="max-width: 300px;overflow: scroll;" v-show="showPublishs" v-cloak>
							<ul class="mui-table-view" v-cloak>
								<li class="mui-table-view-cell mui-collapse" v-for="p in publishs">
									<a class="mui-navigate-right" href="#">{{p.title}}</a>
									<div class="mui-collapse-content">
										<p style="color: #000000;">
											{{p.content}}
										</p>
										<sub>æ—¶é—´:&nbsp;{{p.createTime | dateFormat}}</sub>
									</div>
								</li>
							</ul>
							<div class="vl vl-btn" style="width: 20%;">
								<button type="button" class="mui-btn mui-btn-primary" @click="closePublishs()">æ”¶åˆ°</button>
							</div>
						</div>
					</transition>
					<transition leave-active-class="animated zoomOut" enter-active-class="animated zoomIn">
						<div class="modal-box" style="max-width: 300px;overflow: scroll;" v-show="showSignIn" v-cloak>
							<div style="height: 20px;text-align: center;">
								<p>ç­¾åˆ°æ—¥å†(å¯å¾€ä¸‹æ»‘åŠ¨)</p>
							</div>
							<div id="sign-in-box"></div>
							<p style="text-align: center;">å…±ç­¾åˆ°<span id="signedrec">{{sign.totalCount}}</span>å¤©</p>
							<p style="text-align: center;">å·²è¿ç»­ç­¾åˆ°<span id="signedrec">{{sign.contCount}}</span>å¤©</p>
							<div class="vl vl-btn">
								<button type="button" class="mui-btn mui-btn-primary mui-pull-left" @click="closeCalendar()">å–æ¶ˆ</button>
								<button id="sign" type="button" class="mui-btn mui-btn-primary mui-pull-right" @click="signInToday()">ç­¾åˆ°</button>
							</div>
						</div>
					</transition>
				</div>
			</transition>
			<header class="main-header">
				<div class="profile-left-top1">
					<img :src="user.avatar" class="profile-avatar" @click="showUserInfo()" v-cloak>
					<div class="profile-nickname">
						<div style="margin-top: 5px;height: 15px;">
							<p class="my-p">æ˜µç§°</p>
						</div>
						<div style="margin-top: 0;">
							<p style="color: #F0AD4E;" v-cloak>{{user.nickName}}</p>
						</div>
					</div>
				</div>
				<div class="profile-left-top2" @click="showGift()">
					<img src="img/fuli.png" class="header-vertical-img">
					<p style="color: #F0AD4E;margin-top: -6px;">æ–°äººç¦åˆ©</p>
				</div>
				<div class="profile-center-top">
					<div style="margin: 0 auto;">
						<img src="img/logo.png" class="center-top-logo">
						<div class="center-top-text">
							<p style="font-size: 12px;" class="my-p">æ¸¸æˆå¤§å…</p>
						</div>
					</div>
				</div>
				<div class="profile-right-top1">
					<img src="img/sc.png" class="header-vertical-img">
					<p style="margin-top: -8px;color: #F0AD4E;">å•†åŸ</p>
				</div>
				<div class="profile-right-top2">
					<img src="img/zs.png" class="header-horizontal-img mui-pull-left">
					<div class="header-horizontal-text">
						<p style="font-size: 10px;" class="my-p">{{user.jewel}}</p>
					</div>
					<!-- <img src="img/jh.png" class="header-horizontal-img"> -->
					<i class="mui-pull-left header-horizontal-icon iconfont gobang-icontianjia"></i>
				</div>
				<div class="profile-right-top3">
					<img src="img/jb.png" class="header-horizontal-img mui-pull-left">
					<div class="header-horizontal-text">
						<p style="font-size: 10px;" class="my-p">{{user.gold}}</p>
					</div>
					<!-- <img src="img/jh.png" class="header-horizontal-img"> -->
					<i class="mui-pull-left header-horizontal-icon iconfont gobang-icontianjia"></i>
				</div>
			</header>
			<div style="width: 30%;height: 20px;position: relative;z-index: 20;margin: 0 auto;">
				<marquee scrollamount="5" direction="right" style="background-color: rgba(255,255,255,.2);border-radius: 0 0 25px 25px;">
					<strong style="color: #F0AD4E;" v-cloak>
						<i class="iconfont gobang-iconlaba" v-show="msg.title!=null"></i>
						<span v-show="msg.title!=null">&nbsp;å…¬å‘Š:&nbsp;{{msg.title}}(è¯¦æƒ…è¯·ç‚¹å‡»å…¬å‘ŠæŸ¥çœ‹)</span>
					</strong>
				</marquee>
			</div>
			<div style="width: 100%;height: 80%;margin-top: 20px;">
				<div class="mui-pull-left" style="width: 15%;height: 100%;">
					<div class="content-left-three" @click="showCalendar()">
						<img src="img/qd.png" class="content-left-three-img">
						<div class="content-left-three-text-div">
							<p class="content-left-three-text-p">æ¯æ—¥ç­¾åˆ°</p>
						</div>
					</div>
					<div class="content-left-three" style="margin-top: 20px;">
						<img src="img/play.png" class="content-left-three-img">
						<div class="content-left-three-text-div">
							<p class="content-left-three-text-p">å…è´¹é‡‘å¸</p>
						</div>
					</div>
					<div class="content-left-three" style="margin-top: 20px;">
						<img src="img/fx.png" class="content-left-three-img">
						<div class="content-left-three-text-div">
							<p class="content-left-three-text-p">åˆ†äº«é¢†ğŸ’</p>
						</div>
					</div>
				</div>
				<div class=" mui-pull-left" style="width: 25%;height: 100%;">
					<img src="img/rw.png" style="width: 100%; height: 100%;">
				</div>
				<div class="mui-pull-right" style="width: 50%;height: 100%;">
					<div class="content-right-four" style="background-image: url(img/qp.png);" @click="createRoom()">
						<p class="content-right-four-text">
							åˆ›å»ºæˆ¿é—´
						</p>
					</div>
					<div class="content-right-four" @click="showRoomList()" style="background-image: url(img/qzh.png);margin-left: 10%;margin-top: 40px;">
						<p class="content-right-four-text">
							åŠ å…¥å¯¹å¼ˆ
						</p>
					</div>
					<div class="content-right-four" style="background-image: url(img/jbc.png);">
						<p class="content-right-four-text">
							é‡‘å¸åœº
						</p>
					</div>
					<div class="content-right-four" style="background-image: url(img/bs.png);margin-left: 10%;margin-top: 40px;">
						<p class="content-right-four-text">
							æ¯”èµ›åœº
						</p>
					</div>
				</div>
			</div>
			<nav class="mui-bar mui-bar-tab mui-bar-footer footer-bar-tab">
				<div class="footer-bar-tab-content">
					<div class="mui-pull-left footer-bar-content-div" style="margin-left: 20px;">
						<!-- <img class="mui-pull-left footer-bar-content-narrow-img" src="img/gz.png"> -->
						<div @click="showRule">
							<i class="mui-pull-left footer-bar-content-icon iconfont gobang-iconjishiben-copy"></i>
							<p class="mui-pull-left footer-bar-content-text">è§„åˆ™</p>
						</div>
					</div>
					<div class="mui-pull-left footer-bar-content-div">
						<!-- <img class="mui-pull-left footer-bar-content-wide-img" src="img/kf.png"> -->
						<i class="mui-pull-left footer-bar-content-icon iconfont gobang-iconziyuan"></i>
						<p class="mui-pull-left footer-bar-content-text">å®¢æœ</p>
					</div>
					<div class="mui-pull-left footer-bar-content-div">
						<!-- <img class="mui-pull-left footer-bar-content-narrow-img" src="img/yj.png"> -->
						<div @click="showPublish">
							<i class="mui-pull-left footer-bar-content-icon iconfont gobang-iconlaba"></i>
							<p class="mui-pull-left footer-bar-content-text">å…¬å‘Š</p>
						</div>

					</div>
					<div class="mui-pull-left footer-bar-content-div">
						<!-- <img class="mui-pull-left footer-bar-content-wide-img " src="img/settings_587px.png"> -->
						<i class="mui-pull-left footer-bar-content-icon iconfont gobang-iconshezhi-left"></i>
						<p class="mui-pull-left footer-bar-content-text">è®¾ç½®</p>
					</div>
				</div>
			</nav>
		</div>
		<script>
			var httpServerPrefix = "http://192.168.31.139:8989/Gobang/";
			var app = new Vue({
				el: "#app",
				data: {
					showMask: true,
					newcomer: true,
					isLodding: true,
					showRooms: false,
					showSignIn: false,
					showProfile: false,
					showPublishs: false,
					uid: null,
					user: {},
					sign: {},
					rooms: [],
					w: {},
					publishs: [],
					msg: {}
				},
				created: function() {
					this.windowFull(3);
					setTimeout(function() {
						app.closeLodding();
					}, 500);
					this.uid = window.localStorage.getItem("uid");
					this.getUserbyId(this.uid);
					this.initWebSocket(this.uid);
					if (this.uid != null) {
						this.newcomer = this.bool(window.localStorage.getItem("newcomer"));
						if (!this.newcomer) {
							this.showGift();
						}
					}
					// åˆå§‹åŒ–ç­¾åˆ°æ—¥å†
					this.initSignCalendar();
				},
				methods: {
					showLodding() {
						this.showMask = true;
						this.isLodding = true;
					},
					closeLodding() {
						this.isLodding = false;
						this.showMask = false;
					},
					initSignCalendar() {
						var cld = new Calendar({
							el: '#sign-in-box',
							value: '', // é»˜è®¤ä¸ºnew Date();
							fn: function(obj) {
								console.log(JSON.stringify(obj));
							}
						});
					},
					initSignStatus() {
						/*è·å–æ—¥æœŸ*/
						var dateObj = new Date();
						var nowDate = dateObj.getDate();

						/*æ•°ç»„è¡¨ç¤ºå·²ç­¾åˆ°æ—¥æœŸ*/
						var signList = [];
						if (this.sign.signedTimeList != null && this.sign.signedTimeList !== "") {
							this.sign.signedTimeList.forEach(s => {
								var signObj = {
									signDay: s
								};
								signList.push(signObj);
							});
						}
						
						var canChooses = document.querySelectorAll(".canChoose");
						for (i = 0; i < nowDate; i++) {
							for (var j = 0; j < signList.length; j++) {
								if ((i + 1) == signList[j].signDay) {
									canChooses[i].classList.add("chose");
								}
							}
						}
					},
					getUserbyId(id) {
						if (id != null) {
							mui.ajax(httpServerPrefix + "getUserById?uid=" + id, {
								dataType: 'json', //æœåŠ¡å™¨è¿”å›jsonæ ¼å¼æ•°æ®
								type: 'get', //HTTPè¯·æ±‚ç±»å‹
								timeout: 10000, //è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º10ç§’ï¼›
								success: function(data) {
									if (data.msg == "error") {
										mui.alert("ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥", "é”™è¯¯", "ç¡®å®š", () => {}, 'div');
									} else {
										data.avatar = httpServerPrefix + data.avatar;
										app.user = data;
										app.getSign(id);
										app.searchPub(1, 10);
									}
								},
								error: function(xhr, type, errorThrown) {
									//å¼‚å¸¸å¤„ç†ï¼›
									mui.alert(type, "é”™è¯¯", "ç¡®å®š", () => {}, 'div');
								}
							});
						} else if (id == null) {
							mui.alert("ç”¨æˆ·æœªç™»å½•ï¼Œè¯·é‡æ–°ç™»é™†",
								"æç¤º",
								"å¥½çš„",
								function() {
									window.location.href = "login.html";
								},
								'div');
						}
					},
					// å®‰å“æ²‰æµ¸å¼ 0å…³é—­ 1å®‰å“çŠ¶æ€æ å¯¼èˆªæ éƒ½è¿›å…¥æ²‰æµ¸æ¨¡å¼ 2è®¾ç½®çŠ¶æ€æ æ²‰æµ¸ 3è®¾ç½®å¯¼èˆªæ æ²‰æµ¸
					windowFull(pr) {
						mui.plusReady(function() {
							var main = plus.android.runtimeMainActivity();
							var windowMe = main.getWindow();
							plus.android.importClass(windowMe);
							var decorView = windowMe.getDecorView();
							plus.android.importClass(decorView);
							var View = plus.android.importClass("android.view.View");
							if (pr === 1) {
								decorView.setSystemUiVisibility(
									View.SYSTEM_UI_FLAG_LAYOUT_STABLE |
									View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION |
									View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |
									View.SYSTEM_UI_FLAG_HIDE_NAVIGATION |
									View.SYSTEM_UI_FLAG_FULLSCREEN |
									View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
							} else if (pr === 2) {
								decorView.setSystemUiVisibility(
									View.SYSTEM_UI_FLAG_LAYOUT_STABLE |
									View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |
									View.SYSTEM_UI_FLAG_FULLSCREEN |
									View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
							} else if (pr === 3) {
								decorView.setSystemUiVisibility(
									View.SYSTEM_UI_FLAG_LAYOUT_STABLE |
									View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION |
									View.SYSTEM_UI_FLAG_HIDE_NAVIGATION |
									View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
							} else if (pr === 0) {
								decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
							}
						});
					},
					initWebSocket(id) {
						//è¿æ¥ WebSocket
						this.w = new WebSocket("ws://192.168.31.139:8989/Gobang/echo/" + id);
						this.w.onopen = function() {
							// alert("è¿æ¥ä¸Š");
						};
						this.w.onclose = function() {

						};
						this.w.onmessage = function(event) {
							app.msg = JSON.parse(event.data);
						};
					},
					bool(obj) {
						return (/^true$/i).test(obj);
					},
					showUserInfo() {
						this.showMask = true;
						this.showProfile = true;
					},
					closeUserInfo() {
						this.showProfile = false;
						this.showMask = false;
					},
					showGift() {
						var newcomer = this.newcomer;

						if (!newcomer) {
							var info = document.getElementById("info");
							var btnArray = ['å–æ¶ˆ', 'é¢†å–'];
							mui.confirm(
								'<div class="jb-xrlb"><img src="img/jb.png" class="jb-xrlb-img mui-pull-left"><div class="jb-xrlb-text mui-pull-left"><p style="font-size: 10px;color: #FFEB01;">+1000</p></div><div class="jb-xrlb-text mui-pull-right"><p style="font-size: 10px;color: #FFEB01;">+100</p></div><img src="img/zs.png" class="jb-xrlb-img mui-pull-right"></div>',
								'æ–°äººç¤¼åŒ…',
								btnArray,
								function(e) {
									if (e.index == 1) {
										var newUser = {
											id: 0,
											gold: 0,
											jewel: 0,
											newcomer: true
										};
										newUser.id = app.user.id;
										newUser.gold = app.user.gold + 1000;
										newUser.jewel = app.user.jewel + 100;
										axios.post(httpServerPrefix + "updateUser", newUser)
											.then((res) => {
												//app.ks=res.data;
												var res = res.data;
												if (res.msg != null) {
													if (res.msg === "success") {
														mui.toast('ç¤¼åŒ…å·²é¢†å–', {
															duration: 'long',
															type: 'div'
														});
														app.user.gold = newUser.gold;
														app.user.jewel = newUser.jewel;
														window.localStorage.setItem("newcomer", true);
													} else {
														mui.alert("æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•",
															"å¼‚å¸¸",
															"æ”¶åˆ°",
															() => {},
															'div');
													}
												} else {
													mui.alert("æœåŠ¡å™¨æ— å“åº”ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæ˜¯å¦è¿æ¥",
														"å¼‚å¸¸",
														"æ”¶åˆ°",
														() => {},
														'div');
												}
											})
											.catch((error) => {
												console.log(error); //å¼‚å¸¸
											});

									} else {
										mui.toast('æš‚ä¸é¢†å–', {
											duration: 'long',
											type: 'div'
										});
									}
								}, 'div');

						} else {
							mui.toast('æ‚¨å·²é¢†è¿‡ç¤¼åŒ…ï¼Œä¸èƒ½é‡å¤é¢†å–', {
								duration: 'long',
								type: 'div'
							});
						}
					},
					createRoom() {
						mui.prompt(
							'è¯·è¾“å…¥æˆ¿é—´åç§°',
							'ä¾‹å¦‚ï¼šæ—¶å´ç‹‚ä¸‰çš„æˆ¿é—´',
							'åˆ›å»ºæˆ¿é—´',
							['å–æ¶ˆ', 'åˆ›å»º'],
							function(e) {
								if (e.index == 1) {
									if (e.value == null || e.value === "") {
										mui.alert("è¯·è¾“å…¥æˆ¿é—´åç§°",
											"æç¤º",
											"æ”¶åˆ°",
											() => {},
											'div');
									} else {
										var uid = window.localStorage.getItem("uid");
										roomId = "R" + uid;
										app.w.send(roomId + "," + e.value);
										window.localStorage.setItem("roomId", roomId);
										window.location.href = "room.html";
									}
								} else {
									mui.toast('å–æ¶ˆåˆ›å»º', {
										duration: 'long',
										type: 'div'
									});
								}
							}, 'div');
					},
					showRoomList() {
						mui.ajax(httpServerPrefix + "getRooms", {
							dataType: 'json', //æœåŠ¡å™¨è¿”å›jsonæ ¼å¼æ•°æ®
							type: 'get', //HTTPè¯·æ±‚ç±»å‹
							timeout: 10000, //è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º10ç§’ï¼›
							success: function(data) {
								if (data.msg != null) {
									if (data.msg === "isNull") {
										mui.alert("å½“å‰æ²¡æœ‰ç©å®¶åˆ›å»ºæˆ¿é—´",
											"æç¤º",
											"æ”¶åˆ°",
											() => {},
											'div');
									}
								} else {
									// alert(data);
									data.forEach(r => {
										r.avatar = httpServerPrefix + r.avatar;
									});
									app.rooms = data;
									app.showMask = true;
									app.showRooms = true;
								}
							},
							error: function(xhr, type, errorThrown) {
								//å¼‚å¸¸å¤„ç†ï¼›
								mui.alert(type, "é”™è¯¯", "ç¡®å®š", () => {}, 'div');
							}
						});
					},
					closeRoomList() {
						this.showRooms = false;
						this.showMask = false;
					},
					joinRoom(roomId, roomStatus) {
						if (roomStatus===0) {
							window.localStorage.setItem("roomId", roomId);
							window.location.href = "room.html";
						} else if (roomStatus===1) {
							mui.alert(type, "å½“å‰æˆ¿é—´å·²æ»¡ä¸èƒ½åŠ å…¥", "æ”¶åˆ°", () => {}, 'div');
						}
					},
					showRule() {
						mui.alert(
							"åˆ¤æ–­èƒœè´Ÿè§„åˆ™ï¼š<br>1.æœ€å…ˆåœ¨æ£‹ç›˜æ¨ªå‘ã€ç«–å‘ã€æ–œå‘å½¢æˆè¿ç»­çš„ç›¸åŒè‰²äº”ä¸ªæ£‹å­çš„ä¸€æ–¹ä¸ºèƒœã€‚<br> 2.é»‘æ£‹ç¦æ‰‹åˆ¤è´Ÿï¼Œç™½æ£‹æ— ç¦æ‰‹ã€‚é»‘æ£‹ç¦æ‰‹åŒ…æ‹¬â€œä¸‰ã€ä¸‰â€ (åŒ…æ‹¬â€œå››ã€ä¸‰ã€ä¸‰â€)ã€â€œé•¿è¿â€ã€‚ <br>3.å¦‚åˆ†ä¸å‡ºèƒœè´Ÿï¼Œåˆ™å®šä¸ºå¹³å±€ã€‚ <br>4.äº”è¿ä¸ç¦æ‰‹åŒæ—¶å½¢æˆï¼Œå…ˆäº”ä¸ºèƒœã€‚",
							"è§„åˆ™",
							"æ”¶åˆ°",
							() => {},
							'div');
					},
					searchPub(page, size) {
						axios.get(httpServerPrefix + "getPublishs?page=" + page + "&size=" + size)
							.then((res) => {
								var resp = res.data;
								if (resp.msg != null) {
									if (resp.msg === "dataError") {
										mui.alert('æ•°æ®ä¼ è¾“å¼‚å¸¸',
											'æç¤º',
											'æ”¶åˆ°',
											() => {},
											'div');
									}
								} else {
									this.publishs = resp.data;
								}
							})
							.catch((error) => {
								console.log(error); //å¼‚å¸¸
							});
					},
					showPublish() {
						this.searchPub(1, 10);
						setTimeout(() => {
							if (app.publishs.length !== 0) {
								this.showMask = true;
								this.showPublishs = true;
							} else {
								mui.alert('å½“å‰æ— å…¬å‘Š',
									'å…¬å‘Š',
									'æ”¶åˆ°',
									() => {},
									'div');
							}
						}, 500);
					},
					getSign(id) {
						axios.get(httpServerPrefix + "getSign?uid=" + id)
							.then((res) => {
								var resp = res.data;
								if (resp.msg != null) {
									if (resp.msg === "error") {
										mui.alert('æ•°æ®ä¼ è¾“å¼‚å¸¸',
											'æç¤º',
											'æ”¶åˆ°',
											() => {},
											'div');
									}
								} else {
									/*è·å–æ—¥æœŸ*/
									var dateObj = new Date();
									// è·å–ä»Šå¤©0ç‚¹çš„æ¯«ç§’æ•°
									var start = new Date(dateObj.toLocaleDateString()).getTime();
									if (resp.lastTime != null || resp.lastTime !== "") {
										if (start - resp.lastTime > 86400000) {
											resp.contCount = 0;
										}
									}
									if (resp.signedTime != null || resp.signedTime != "") {
										if (dateObj.getDate() == 1) {
											resp.signedTime = "";
										}
									}
									this.sign = resp;
								}
							})
							.catch((error) => {
								console.log(error); //å¼‚å¸¸
							});
					},
					closePublishs() {
						this.showPublishs = false;
						this.showMask = false;
					},
					showCalendar() {
						// åˆå§‹åŒ–ç­¾åˆ°æ—¥å†
						this.initSignStatus();
						this.showMask = true;
						this.showSignIn = true;
					},
					signInToday() {
						/*è·å–å½“å‰æ—¶é—´*/
						var dateObj = new Date();
						// è·å–ä»Šå¤©0ç‚¹çš„æ¯«ç§’æ•°
						var start = new Date(dateObj.toLocaleDateString()).getTime();
						if (this.sign.lastTime == null || this.sign.lastTime === "") {
							this.sign.lastTime = 0;
						}
						// console.log(dateObj.getTime());
						if (start > this.sign.lastTime) {
							var today = document.querySelector(".today");
							today.classList.add("chose");
							today.classList.remove("today");
							// signedrec.innerHTML=count+1;
							this.sign.totalCount++;
							this.sign.contCount++;
							if (this.sign.signedTimeList == null || this.sign.signedTimeList === "") {
								this.sign.signedTimeList = []
								this.sign.signedTimeList.push(dateObj.getDate());
							} else {
								this.sign.signedTimeList.push(dateObj.getDate());
							}
							if (this.sign.signedTime == null || this.sign.signedTime === "") {
								this.sign.signedTime = dateObj.getDate() + "";
							} else {
								this.sign.signedTime += "," + dateObj.getDate();
							}
							this.sign.lastTime = dateObj;
							axios.post(httpServerPrefix + "signIn", this.sign)
								.then((res) => {
									var resp = res.data;
									if (resp.msg != null) {
										if (resp.msg === "error") {
											mui.alert('æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•',
												'æç¤º',
												'æ”¶åˆ°',
												() => {},
												'div');
										} else if (resp.msg === "success") {
											this.closeCalendar();
											var temp = {
												id: this.user.id,
												gold: this.user.gold
											};
											var addGold = 5 + this.sign.contCount * 5;
											temp.gold += addGold;
											axios.post(httpServerPrefix + "updateUser", temp)
												.then((res) => {
													//app.ks=res.data;
													var res = res.data;
													if (res.msg != null) {
														if (res.msg === "success") {
															this.user.gold = temp.gold;
															mui.toast('ç­¾åˆ°æˆåŠŸï¼Œé‡‘å¸+' + addGold, {
																duration: 'long',
																type: 'div'
															});
														} else {
															mui.alert("ç­¾åˆ°æˆåŠŸï¼ŒæœåŠ¡å™¨å“åº”å¼‚å¸¸ï¼Œè¯·è”ç³»å®¢æœé¢†å–é‡‘å¸",
																"å¼‚å¸¸",
																"æ”¶åˆ°",
																() => {},
																'div');
														}
													} else {
														mui.alert("ç­¾åˆ°æˆåŠŸï¼ŒæœåŠ¡å™¨æ— å“åº”ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæ˜¯å¦è¿æ¥ï¼Œå¹¶è”ç³»å®¢æœé¢†å–é‡‘å¸",
															"å¼‚å¸¸",
															"æ”¶åˆ°",
															() => {},
															'div');
													}
												})
												.catch((error) => {
													console.log(error); //å¼‚å¸¸
												});
										}
									}
								})
								.catch((error) => {
									console.log(error); //å¼‚å¸¸
								});
						} else {
							mui.alert('æ‚¨ä»Šå¤©å·²ç­¾è¿‡åˆ°ï¼Œä¸èƒ½é‡å¤ç­¾åˆ°',
								'æç¤º',
								'æ”¶åˆ°',
								() => {},
								'div');
						}
					},
					closeCalendar() {
						this.showSignIn = false;
						this.showMask = false;
					}

				},
				filters: {
					/*æ—¥æœŸå¤„ç†*/
					dateFormat(date) {
						return moment(date).format("YYYY-MM-DD HH:mm:ss");
					},
				}
			});
			// var cld = new Calendar({
			//             el: '#sign-in-box',
			//             value: '', // é»˜è®¤ä¸ºnew Date();
			//             fn: function(obj) {
			//                 console.log(JSON.stringify(obj));
			//             }
			//         });
		</script>
	</body>
</html>
