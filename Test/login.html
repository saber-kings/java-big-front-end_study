<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>登陆</title>
		<script src="js/vue.js"></script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
	</head>
	<body>
		<div id="login"></div>
		<script>
			var isRegist = false;
			var isLogin = false;
			var app = new Vue({
				el: '#login',
				data: {
					user: {
						username: "",
						password: ""
					},
					users: [{
						username: "admin",
						password: "123456"
					}]
				}
			});
			console.log("已注册用户:");
			for (var i = 0; i < app.users.length; i++) {
				console.log(app.users[i].username + ":" + app.users[i].password);
			}

			function regAlog(isregist, islogin) {
				var users = app.users;
				var user = app.user;
				if (isregist) {
					var rname = prompt("请输入用户名:");
					var i;
					for (i = 0; i < users.length; i++) {
						if (users[i].username == rname) {
							alert(users[i].username);
							rname = prompt("该用户已存在，请重新输入！:");
							i = -1;
						}
					}
					user.username = rname;
					user.password = prompt("请输入密码:");
					users.push(user);
					alert("注册成功！");
					islogin = true;
				} else {
					var lname = prompt("请输入用户名:");
					var j = 0;
					var k = 0;
					var lg;
					for (lg = 0; lg < users.length; lg++) {
						if (users[lg].username == lname) {
							var passw = prompt("请输入密码:");
							if (passw == users[lg].password) {
								alert("登陆成功!");
								islogin = true;
								break;
							} else {
								for (k = 0; k < 2 && passw != users[lg].password; k++) {
									passw = prompt("密码错误!请重新输入密码:");
								}
								if (k >= 2) {
									alert("超过次数，请重新登陆！");
									break;
								} else if (passw == users[lg].password) {
									alert("登陆成功!");
									islogin = true;
									break;
								}
							}
						} else if (lg == users.length - 1) {
							lname = prompt("用户名错误，请重新输入:");
							lg = -1;
							if (j++ > 3) {
								alert("超过次数，请重新登陆！");
								break;
							}
						}
					}
				}
				if (islogin) {
					window.localStorage.setItem("isLogin", islogin);
					window.location.href = "books.html";
				}
			}

			isRegist = window.confirm("请选择是否注册");
			regAlog(isRegist, isLogin);
		</script>
	</body>
</html>
